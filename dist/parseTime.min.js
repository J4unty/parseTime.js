/* * * * * * * * * *
 *  parseTime .js  *
 *  Version 0.2.3  *
 *  License:  MIT  *
 * Simon  Waldherr *
 * * * * * * * * * */

var parseTimeObject={words:{en:{numbers:{zero:0,one:1,two:2,three:3,"a few":3.5,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19,twenty:20,thirty:30,forty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90,hundred:100,thousend:1e3,million:1e6},unit:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:2592e6,quarter:7776e6,year:31536e6,decade:31536e7},countable:{"before yesterday":-1728e5,yesterday:-864e5,today:1,"day after tomorrow":1728e5,tomorrow:864e5,"in a week":6048e5,"last week":-6048e5},month:{jan:"01",feb:"02",mar:"03",apr:"04",may:"05",jun:"06",jul:"07",aug:"08",sep:"09",oct:"10",nov:"11",dec:"12"},daytime:{dawn:"04:00",morning:"06:00",afternoon:"15:00",noon:"12:00",midday:"12:00","pre-evening":"17:00",preevening:"17:00",evening:"19:00",dusk:"20:00",midnight:"24:00",night:"22:00"},fillwords:{ago:"-","in":"+"},fillfoo:{s:"","\\-":"","\\ ":"","\\.":""}}},regexes:{}},parseTime=function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l,m={},n={},o=function(a,b){var c,e="";for(c in parseTimeObject.words[d][a])void 0!==parseTimeObject.words[d][a][c]&&(b===!1?e+="|":b=!1,e+=c);return e},p=function(b){var c,d,e={},f=Object.keys(b);for(c=0;c<f.length;c+=1)-1!==a.indexOf(f[c])&&(e[f[c]]=a.indexOf(f[c]),d=!0);return d?e:!1};if(void 0===b?b=(new Date).getTime():"object"==typeof b&&(b=b.getTime()),a=a.toLowerCase().replace(/["'<>\(\)]/gm,"").replace(/(\d)([A-Za-z])/,"$1 $2","gm"),b=parseInt(b,10),"now"===a||"jetzt"===a)return{absolute:Date.now(),relative:0,mode:"now",pb:1};if(n.parsed=new Date,n.parsed=new Date(Date.parse(a.replace(/((\d{1,2})(th |rd |ter ))/,"$2 ","gm"))),!isNaN(n.parsed))return-1===a.indexOf(n.parsed.getFullYear())&&(n.now=new Date,n.now=Date.parse(b),isNaN(n.now)||(n.parsed.setFullYear(n.now.getFullYear()),n.parsed.setTime(n.parsed.getTime()+864e5))),n.parsed=n.parsed.getTime(),{absolute:n.parsed,relative:n.parsed-b,mode:"absolute",pb:2};if(k=/((\d\d)\.(\d\d)\.(\d\d\d\d) (\d\d):(\d\d):(\d\d))/.exec(a),null!==k?(n.day=1===k[2].length?"0"+k[2]:k[2],n.month=1===k[3].length?"0"+k[3]:k[3],n.year=2===k[4].length?"20"+k[4]:k[4],n.hour=1===k[5].length?"0"+k[5]:k[5],n.minute=1===k[6].length?"0"+k[6]:k[6],n.second=1===k[7].length?"0"+k[7]:k[7],h=3):(k=/((\S+\s){0,4}(\d{1,2})((:(\d{1,2})(:(\d{1,2})(\.(\d{1,4}))?)?)|( uhr| oclock)))/.exec(a),null!==k?(n.countable=k[0],n.hour=void 0===k[3]?"12":1===k[3].length?"0"+k[3]:k[3],n.minute=void 0===k[6]?"00":1===k[6].length?"0"+k[6]:k[6],n.second=void 0===k[7]?"00":1===k[7].length?"0"+k[7]:k[7],n.second=n.second.replace(":",""),h=4):(k=/((\d\d)[\.:,\/](\d\d)[\.:,\/](\d\d\d\d)(\s\S+){0,4})/.exec(a),null!==k&&(n.day=1===k[2].length?"0"+k[2]:k[2],n.month=1===k[3].length?"0"+k[3]:k[3],n.year=2===k[4].length?"20"+k[4]:k[4],n.countable=k[5],h=5))),void 0!==n.hour){for(d in parseTimeObject.words)if(void 0!==parseTimeObject.words[d])for(j in parseTimeObject.words[d].countable)void 0!==parseTimeObject.words[d].countable[j]&&void 0!==n.countable&&-1!==n.countable.indexOf(j)&&void 0===n.countableint&&(n.countableint=parseTimeObject.words[d].countable[j])}else for(d in parseTimeObject.words)if(void 0!==parseTimeObject.words[d])for(j in parseTimeObject.words[d].daytime)void 0!==parseTimeObject.words[d].daytime[j]&&(void 0!==n.countable?(n.countable=n.countable.trim(),-1!==n.countable.indexOf(j)&&void 0===n.countableint&&(n.countableint=0,n.hour=parseTimeObject.words[d].daytime[j].split(":")[0],n.minute=parseTimeObject.words[d].daytime[j].split(":")[1],n.second="00",h=6)):-1!==a.indexOf(j)&&p(parseTimeObject.words[d].countable,a)!==!1&&(k=j,j=p(parseTimeObject.words[d].countable,a),j=Object.keys(j)[0],void 0!==j&&j!==k&&(n.countable=j,n.countableint=parseTimeObject.words[d].countable[j],k=parseTimeObject.words[d].daytime[k],n.hour=k.split(":")[0],n.minute=k.split(":")[1],n.second="00",h=7,console.log([n,k]))));if(n.now=void 0!==n.countableint?new Date(b+n.countableint).getTime():new Date(b).getTime(),void 0===n.year?(n.parsed=new Date,n.parsed.setTime(n.now),n.day=n.parsed.getDate().toString(),n.month=(n.parsed.getMonth()+1).toString(),n.year=n.parsed.getFullYear().toString(),n.day=1===n.day.length?"0"+n.day:n.day,n.month=1===n.month.length?"0"+n.month:n.month,n.today=n.year+"-"+n.month+"-"+n.day):n.today=n.year+"-"+n.month+"-"+n.day,void 0!==n.hour?(n.string=n.today+"T"+n.hour+":"+n.minute+":"+n.second+"+00:00",n.parsed=new Date,n.parsed=Date.parse(n.string)):void 0!==n.day&&void 0!==n.today&&(n.string=n.today+"T12:00:00+00:00",n.parsed=new Date,n.parsed=Date.parse(n.string)),"number"==typeof n.parsed&&void 0!==h&&!isNaN(n.parsed))return l=-3e4*(new Date).getTimezoneOffset(),3===h||5===h?n.parsed=n.parsed-l:4===h&&(n.parsed=n.parsed-2*l),{absolute:n.parsed,relative:n.parsed-b,mode:"absolute",pb:h};a=" "+a+" ";for(d in parseTimeObject.words)void 0!==parseTimeObject.words[d]&&(parseTimeObject.regexes[d]="((",parseTimeObject.regexes[d]+=o("fillfoo",!0),parseTimeObject.regexes[d]+=")+(",parseTimeObject.regexes[d]+=o("fillwords",!0),parseTimeObject.regexes[d]+=")*(",parseTimeObject.regexes[d]+=o("fillfoo",!0),parseTimeObject.regexes[d]+=")*(\\d+",parseTimeObject.regexes[d]+=o("numbers",!1),parseTimeObject.regexes[d]+=")+(",parseTimeObject.regexes[d]+=o("fillfoo",!0),parseTimeObject.regexes[d]+=")*((",parseTimeObject.regexes[d]+=o("unit",!0),parseTimeObject.regexes[d]+=")(",parseTimeObject.regexes[d]+=o("fillfoo",!0),parseTimeObject.regexes[d]+=")*",parseTimeObject.regexes[d]+=o("fillfoo",!1),parseTimeObject.regexes[d]+=")*(",parseTimeObject.regexes[d]+=o("fillwords",!0),parseTimeObject.regexes[d]+=")*(",parseTimeObject.regexes[d]+=o("fillfoo",!0),parseTimeObject.regexes[d]+=")+)");for(d in parseTimeObject.regexes)if(void 0!==parseTimeObject.regexes[d]&&(c=new RegExp(parseTimeObject.regexes[d]),e=c.exec(a),f=0,null!==e&&void 0!==e[8]))return g=isNaN(parseInt(e[5],10))?parseTimeObject.words[d].numbers[e[5]]:parseInt(e[5],10),i=parseTimeObject.words[d].unit[e[8].toLowerCase()],f=g*i,-1!==e.indexOf(Object.keys(parseTimeObject.words[d].fillwords)[0])?(n.parsed=-f,{absolute:b-f,relative:n.parsed,mode:"relative",pb:8}):{absolute:b+f,relative:f,mode:"relative",pb:9};return m.match=/(\d\d?)[,\.](\d\d?)[,\.](\d\d(\d\d)?)/.exec(a),null!==m.match?(m.day=m.match[1],m.month=m.match[2],m.year=m.match[3],h=10):(m.match=/(\d\d(\d\d)?)[\/\-](\d\d?)[\/\-](\d\d?)/.exec(a),null!==m.match&&(m.day=m.match[4],m.month=m.match[3],m.year=m.match[1],h=11)),void 0!==m.day?(m.day=1===m.day.length?"0"+m.day:m.day,m.month=1===m.month.length?"0"+m.month:m.month,m.year=2===m.year.length?parseInt(m.year,10)>70?"19"+m.year:"20"+m.year:m.year,n.today=m.year+"-"+m.month+"-"+m.day,n.string=n.today+"T12:00:00+00:00",n.parsed=new Date,n.parsed=Date.parse(n.string),{absolute:n.parsed,relative:n.parsed-b,mode:"absolute",pb:h}):{absolute:!1,relative:!1,mode:"error",pb:!1}};parseTimeObject.words.de={numbers:{"null":0,ein:1,zwei:2,drei:3,"ein paar":3.5,vier:4,"fünf":5,sechs:6,sieben:7,acht:8,neun:9,zehn:10,elf:11,"zwölf":12,dreizehn:13,vierzehn:14,"fünfzehn":15,sechzehn:16,siebzehn:17,achzehn:18,neinzehn:19,zwanzig:20,"dreißig":30,vierzig:40,"fünfzig":50,sechzig:60,siebzig:70,achtzig:80,neunzig:90,hundert:100,tausend:1e3,million:1e6},countable:{vorgestern:-1728e5,gestern:-864e5,heute:1,"übermorgen":1728e5,morgen:864e5,"nächste woche":6048e5,"vorherige woche":-6048e5},daytime:{"morgendämmerung":"04:00",tagesanbruch:"04:00",morgen:"06:00",vormittag:"09:00",nachmittag:"15:00",mittag:"12:00","präabend":"17:00",abend:"19:00","dämmerung":"20:00",mitternacht:"24:00",nacht:"22:00"},unit:{millisekunde:1,sekunde:1e3,minute:6e4,stunde:36e5,tag:864e4,woche:6048e5,monat:2592e6,quartal:7776e6,jahr:31536e6,dekade:31536e7},fillwords:{vor:"-","in":"+"},fillfoo:{"\\-":"","\\ ":"",e:"",en:"",er:"",n:""}};